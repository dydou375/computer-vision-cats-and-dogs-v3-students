# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“¢ GRAFANA CONTACT POINTS - Canaux de notification
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ¯ OBJECTIF
# DÃ©finit les destinations pour les notifications d'alertes Grafana.
# Contact point = canal de communication (Discord, Slack, Email, PagerDuty, etc.)
#
# ğŸ“š CONCEPTS CLÃ‰S
# - Contact point : endpoint de notification (1 ou plusieurs receivers)
# - Receiver : configuration spÃ©cifique d'un type de canal
# - uid : identifiant unique pour rÃ©fÃ©rencer dans notification policies
# - Provisioning : config as code (appliquÃ©e automatiquement au dÃ©marrage)
#
# ğŸ”— WORKFLOW ALERTING
# Alert Rule (trigger) â†’ Notification Policy (routing) â†’ Contact Point â†’ Discord
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

apiVersion: 1
# ğŸ“Œ Version format provisioning Grafana (stable depuis v8+)

contactPoints:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ“¢ CONTACT POINT : Discord pour alertes CV
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - orgId: 1
    # ğŸ¢ Organization ID (dÃ©faut : 1 pour installation standard)
    # Multi-tenancy Grafana : sÃ©parer configs par organisation
    # En environnement simple : toujours 1
    
    name: Discord CV Alerts
    # ğŸ·ï¸ Nom descriptif du contact point (affichÃ© dans UI Grafana)
    # Convention : inclure plateforme (Discord) + contexte (CV)
    # UtilisÃ© dans notification policies pour router alertes
    
    receivers:
      # ğŸ“¡ Liste des receivers (1 contact point = N receivers possibles)
      # Exemple multi-canal :
      #   - Discord (temps rÃ©el)
      #   - Email (backup si Discord down)
      #   - PagerDuty (escalation si non rÃ©solu)
      
      - uid: discord-cv-webhook
        # ğŸ†” Identifiant unique du receiver
        # Format libre, mais doit Ãªtre unique dans Grafana
        # Bonne pratique : {type}-{context}-{descriptor}
        
        type: discord
        # ğŸ“Œ Type de receiver (dÃ©finit le protocole)
        # Types disponibles : discord, slack, email, webhook, pagerduty,
        #                     opsgenie, victorops, telegram, teams, etc.
        # Voir : https://grafana.com/docs/grafana/latest/alerting/manage-notifications/
        
        settings:
          # âš™ï¸ Configuration spÃ©cifique au type Discord
          
          url: ${DISCORD_WEBHOOK_URL}
          # ğŸ”— URL webhook Discord (endpoint API)
          # Format : https://discord.com/api/webhooks/{id}/{token}
          # 
          # âš ï¸ SÃ‰CURITÃ‰ CRITIQUE
          # Cette URL donne accÃ¨s TOTAL au canal Discord configurÃ©.
          # Quiconque possÃ¨de l'URL peut poster des messages.
          # 
          # ğŸ” BONNE PRATIQUE PRODUCTION
          # NE PAS hardcoder l'URL ici (exposÃ© dans Git).
          # Utiliser variable d'environnement :
          #   url: ${DISCORD_WEBHOOK_URL}
          # Puis dans docker-compose.yml :
          #   GF_DISCORD_WEBHOOK_URL: ${DISCORD_WEBHOOK_URL}
          # Et .env (gitignored) :
          #   DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/...
          #
          # ğŸ’¡ GÃ‰NÃ‰RATION WEBHOOK DISCORD
          # 1. Discord â†’ ParamÃ¨tres serveur â†’ IntÃ©grations â†’ Webhooks
          # 2. Nouveau Webhook
          # 3. SÃ©lectionner canal (#alerts, #monitoring, etc.)
          # 4. Copier URL
          # 5. Ne JAMAIS commit dans Git public
          
          use_discord_username: true
          # ğŸ¤– Utilise le nom du webhook Discord comme nom d'expÃ©diteur
          # true : messages apparaissent avec nom dÃ©fini dans Discord UI
          # false : Grafana impose "Grafana" comme nom (moins flexible)
          #
          # ğŸ’¡ CUSTOMISATION
          # Dans Discord UI webhook settings :
          #   - Nom : "MLOps Bot" ou "CV Monitoring"
          #   - Avatar : icÃ´ne custom (logo ML, robot, etc.)
          # â†’ Messages Grafana apparaÃ®tront avec cette identitÃ©
        
        disableResolveMessage: false
        # ğŸ”” Envoie notification quand alerte se rÃ©sout (retour Ã  normal)
        # 
        # false (dÃ©faut) : 2 messages Discord
        #   1. ğŸš¨ "Alert firing: HighLatency detected"
        #   2. âœ… "Alert resolved: HighLatency back to normal"
        #
        # true : 1 seul message (firing), pas de rÃ©solution
        #   â†’ Moins verbeux mais perte d'info (combien de temps down ?)
        #
        # ğŸ’¡ RECOMMANDATION
        # Garder false pour :
        # - TraÃ§abilitÃ© complÃ¨te (durÃ©e incident visible)
        # - Confirmation rÃ©solution (Ã©quipe informÃ©e que c'est rÃ©glÃ©)
        # - Post-mortem (timeline Ã©vÃ©nements dans historique Discord)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“ CONFIGURATION AVANCÃ‰E (exemples)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# MULTI-RECEIVERS (Discord + Email backup)
#   contactPoints:
#     - orgId: 1
#       name: Primary Alerts
#       receivers:
#         - uid: discord-main
#           type: discord
#           settings:
#             url: ${DISCORD_WEBHOOK_URL}
#         - uid: email-backup
#           type: email
#           settings:
#             addresses: ops@example.com
#             singleEmail: true
#
# MESSAGE CUSTOMISÃ‰
#   settings:
#     url: ${DISCORD_WEBHOOK_URL}
#     message: |
#       ğŸš¨ **{{ .Status | toUpper }}** - {{ .GroupLabels.alertname }}
#       
#       **Summary:** {{ index .Alerts 0 .Annotations.summary }}
#       **Severity:** {{ .GroupLabels.severity }}
#       **Dashboard:** {{ .ExternalURL }}/d/cv-dashboard
#     use_discord_username: true
#   â†’ Template Go pour formater message Discord
#
# WEBHOOK GÃ‰NÃ‰RIQUE (non Discord)
#   - uid: custom-webhook
#     type: webhook
#     settings:
#       url: https://my-api.com/alerts
#       httpMethod: POST
#       maxAlerts: 0
#   â†’ IntÃ©gration custom (ex: systÃ¨me interne ticketing)
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ› ï¸ TESTS ET VALIDATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# TEST DEPUIS GRAFANA UI
#   1. Alerting â†’ Contact points
#   2. Trouver "Discord CV Alerts"
#   3. Bouton "Test" â†’ Send test notification
#   4. VÃ©rifier message dans canal Discord
#
# TEST PROVISIONING
#   docker compose restart grafana
#   docker compose logs grafana | grep -i "provisioning"
#   â†’ Chercher "contact point provisioned successfully"
#
# VALIDATION YAML
#   yamllint contact-points.yml
#   â†’ VÃ©rifier syntaxe avant commit
#
# DEBUG NOTIFICATIONS
#   Grafana UI â†’ Alerting â†’ Contact points â†’ View notification history
#   â†’ Voir tentatives envoi, erreurs, timestamps
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ” SÃ‰CURITÃ‰ - ROTATION WEBHOOK
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Si webhook compromis (leak Git, logs publics) :
#
# 1. RÃ‰VOQUER WEBHOOK
#    Discord â†’ ParamÃ¨tres serveur â†’ IntÃ©grations â†’ Webhooks
#    â†’ Supprimer webhook compromis
#
# 2. CRÃ‰ER NOUVEAU WEBHOOK
#    â†’ GÃ©nÃ©rer nouvelle URL
#
# 3. METTRE Ã€ JOUR CONFIG
#    .env : DISCORD_WEBHOOK_URL=nouvelle_url
#    contact-points.yml : url: ${DISCORD_WEBHOOK_URL}
#
# 4. REDÃ‰PLOYER
#    docker compose down && docker compose up -d
#
# 5. TESTER
#    Grafana UI â†’ Test contact point
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“š RESSOURCES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# - Contact points : https://grafana.com/docs/grafana/latest/alerting/manage-notifications/create-contact-point/
# - Discord integration : https://grafana.com/docs/grafana/latest/alerting/manage-notifications/integrations/discord/
# - Message templating : https://grafana.com/docs/grafana/latest/alerting/manage-notifications/template-notifications/
# - Provisioning : https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•